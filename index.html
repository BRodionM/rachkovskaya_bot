<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ò–ø–æ—Ç–µ—á–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ (Gemini Style) */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: #131314; /* –û—á–µ–Ω—å —Ç–µ–º–Ω—ã–π —Å–µ—Ä—ã–π —Ñ–æ–Ω */
            color: #E3E3E3; 
            margin: 0; 
            padding: 20px; 
        }
        .container { max-width: 600px; margin: 0 auto; padding-bottom: 80px; }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card { 
            background: #1E1F20; /* –ß—É—Ç—å —Å–≤–µ—Ç–ª–µ–µ —Ñ–æ–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ */
            border-radius: 16px; 
            padding: 20px; 
            margin-bottom: 15px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.3); 
        }
        
        /* –¢–µ–∫—Å—Ç—ã */
        .label { font-size: 13px; color: #9AA0A6; margin-bottom: 8px; display: block; }
        .input-wrapper { 
            display: flex; 
            align-items: center; 
            background: #2D2E30; /* –§–æ–Ω –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ */
            border-radius: 10px; 
            padding: 12px; 
            border: 1px solid #444746;
        }
        .input-wrapper input, .input-wrapper select { 
            background: transparent; 
            border: none; 
            font-size: 18px; 
            color: #fff; 
            width: 100%; 
            outline: none; 
            font-weight: 500;
        }
        .suffix { color: #9AA0A6; font-size: 16px; margin-left: 5px; }
        
        /* –°–ª–∞–π–¥–µ—Ä—ã */
        input[type=range] { 
            width: 100%; 
            margin-top: 15px; 
            accent-color: #8AB4F8; /* –ì–æ–ª—É–±–æ–π —Ü–≤–µ—Ç –∫–∞–∫ —É Google */
            cursor: pointer; 
            background: transparent;
        }

        /* –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ (–±–∞—Ä–∞–±–∞–Ω –Ω–∞ iPhone) */
        select { -webkit-appearance: none; appearance: none; }
        
        /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */
        .results { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .result-item { margin-bottom: 10px; }
        .res-value { font-size: 20px; font-weight: bold; display: block; color: #E3E3E3; }
        .res-label { font-size: 12px; color: #9AA0A6; }
        
        .green-text { color: #8AB4F8; } /* –ì–æ–ª—É–±–æ–π –∞–∫—Ü–µ–Ω—Ç */
        .main-payment { font-size: 32px; margin-bottom: 5px; color: #A8C7FA; }
        
        /* –ö–Ω–æ–ø–∫–∞ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª */
        .link-btn {
            display: block;
            width: 100%;
            text-align: center;
            padding: 15px 0;
            margin-top: 10px;
            color: #8AB4F8;
            text-decoration: none;
            font-weight: 500;
            border: 1px solid #444746;
            border-radius: 12px;
            background: #1E1F20;
        }
    </style>
</head>
<body>

<div class="container">
    <!-- –ë–ª–æ–∫ –≤–≤–æ–¥–∞ -->
    <div class="card">
        <div class="input-group" style="margin-bottom: 20px;">
            <span class="label">–°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</span>
            <div class="input-wrapper">
                <input type="number" id="price" value="4000000">
                <span class="suffix">‚ÇΩ</span>
            </div>
            <input type="range" id="priceRange" min="500000" max="30000000" step="100000" value="4000000">
        </div>

        <div class="input-group" style="margin-bottom: 20px;">
            <span class="label">–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å</span>
            <div class="input-wrapper">
                <input type="number" id="initial" value="2500000">
                <span class="suffix">‚ÇΩ</span>
            </div>
            <input type="range" id="initialRange" min="0" max="4000000" step="50000" value="2500000">
        </div>

        <div style="display: flex; gap: 15px;">
            <!-- –°—Ä–æ–∫ (–í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫) -->
            <div class="input-group" style="flex: 1;">
                <span class="label">–°—Ä–æ–∫</span>
                <div class="input-wrapper">
                    <select id="years">
                        <!-- –û–ø—Ü–∏–∏ –¥–æ–±–∞–≤—è—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
                    </select>
                </div>
            </div>
            <!-- –°—Ç–∞–≤–∫–∞ -->
            <div class="input-group" style="flex: 1;">
                <span class="label">–°—Ç–∞–≤–∫–∞</span>
                <div class="input-wrapper">
                    <input type="number" id="rate" value="10.5">
                    <span class="suffix">%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- –ë–ª–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div class="card">
        <div class="result-item" style="border-bottom: 1px solid #444746; padding-bottom: 15px; margin-bottom: 15px;">
            <span class="res-value main-payment" id="monthlyPayment">0 ‚ÇΩ</span>
            <span class="res-label">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂</span>
        </div>

        <div class="results">
            <div class="result-item">
                <span class="res-value" id="loanAmount">0 ‚ÇΩ</span>
                <span class="res-label">–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞</span>
            </div>
            <div class="result-item">
                <span class="res-value" id="totalPayout">0 ‚ÇΩ</span>
                <span class="res-label">–û–±—â–∞—è –≤—ã–ø–ª–∞—Ç–∞</span>
            </div>
            <div class="result-item">
                <span class="res-value" id="overpayment">0 ‚ÇΩ</span>
                <span class="res-label">–ü–µ—Ä–µ–ø–ª–∞—Ç–∞</span>
            </div>
             <div class="result-item">
                <span class="res-value" id="incomeReq">0 ‚ÇΩ</span>
                <span class="res-label">–ù—É–∂–Ω—ã–π –¥–æ—Ö–æ–¥</span>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –∫–∞–Ω–∞–ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤–Ω—É—Ç—Ä–∏ WebApp) -->
    <a href="https://t.me/agentyanaa" class="link-btn" onclick="tg.close()">
        üì¢ –ö–∞–Ω–∞–ª –Ø–Ω—ã –†–∞—á–∫–æ–≤—Å–∫–æ–π
    </a>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –≥–æ–¥–∞–º–∏ (–æ—Ç 1 –¥–æ 30)
    const yearsSelect = document.getElementById('years');
    for (let i = 1; i <= 30; i++) {
        let option = document.createElement('option');
        option.value = i;
        option.text = i + (i === 1 ? ' –≥–æ–¥' : (i >= 2 && i <= 4 ? ' –≥–æ–¥–∞' : ' –ª–µ—Ç'));
        if (i === 20) option.selected = true; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 20 –ª–µ—Ç
        yearsSelect.appendChild(option);
    }

    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const inputs = {
        price: document.getElementById('price'),
        priceRange: document.getElementById('priceRange'),
        initial: document.getElementById('initial'),
        initialRange: document.getElementById('initialRange'),
        years: document.getElementById('years'),
        rate: document.getElementById('rate')
    };

    const outputs = {
        monthly: document.getElementById('monthlyPayment'),
        loan: document.getElementById('loanAmount'),
        total: document.getElementById('totalPayout'),
        overpayment: document.getElementById('overpayment'),
        income: document.getElementById('incomeReq')
    };

    const fmt = (num) => new Intl.NumberFormat('ru-RU').format(Math.round(num)) + ' ‚ÇΩ';

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–∞
    let calcData = {};

    function calculate() {
        let price = parseFloat(inputs.price.value) || 0;
        let initial = parseFloat(inputs.initial.value) || 0;
        let years = parseFloat(inputs.years.value) || 0;
        let rate = parseFloat(inputs.rate.value) || 0;

        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
        inputs.priceRange.value = price;
        inputs.initialRange.max = price;
        inputs.initialRange.value = initial;

        if (initial > price) { initial = price; inputs.initial.value = price; }

        let loanAmount = price - initial;
        let months = years * 12;
        let monthlyRate = rate / 12 / 100;
        let monthlyPayment = 0;
        
        if (loanAmount > 0 && months > 0) {
            if (monthlyRate === 0) monthlyPayment = loanAmount / months;
            else monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);
        }

        let totalPayout = monthlyPayment * months;
        let overpayment = totalPayout - loanAmount;
        let incomeReq = monthlyPayment * 1.6; // –ü—Ä–∏–º–µ—Ä–Ω—ã–π –¥–æ—Ö–æ–¥ (–ø–ª–∞—Ç–µ–∂ * 1.6)

        outputs.monthly.innerText = fmt(monthlyPayment);
        outputs.loan.innerText = fmt(loanAmount);
        outputs.total.innerText = fmt(totalPayout);
        outputs.overpayment.innerText = fmt(overpayment);
        outputs.income.innerText = fmt(incomeReq);

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –±–æ—Ç—É
        calcData = {
            price: fmt(price),
            initial: fmt(initial),
            years: years,
            rate: rate,
            monthly: fmt(monthlyPayment),
            loan: fmt(loanAmount),
            overpayment: fmt(overpayment),
            total: fmt(totalPayout)
        };
    }

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ì–õ–ê–í–ù–£–Æ –ö–ù–û–ü–ö–£ (MainButton) –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ Telegram
    tg.MainButton.setText("–ó–ê–§–ò–ö–°–ò–†–û–í–ê–¢–¨ –†–ê–°–ß–ï–¢–´ ‚úÖ");
    tg.MainButton.show();
    tg.MainButton.onClick(function() {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ –±–æ—Ç—É
        tg.sendData(JSON.stringify(calcData));
    });

    // –°–ª—É—à–∞—Ç–µ–ª–∏
    inputs.price.oninput = () => { inputs.priceRange.value = inputs.price.value; calculate(); };
    inputs.priceRange.oninput = () => { inputs.price.value = inputs.priceRange.value; calculate(); };
    inputs.initial.oninput = () => { inputs.initialRange.value = inputs.initial.value; calculate(); };
    inputs.initialRange.oninput = () => { inputs.initial.value = inputs.initialRange.value; calculate(); };
    inputs.years.onchange = calculate; // –î–ª—è select –∏—Å–ø–æ–ª—å–∑—É–µ–º onchange
    inputs.rate.oninput = calculate;

    calculate();
</script>
</body>
</html>
